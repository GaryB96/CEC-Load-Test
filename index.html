<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Load Test</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0b6ef0"/>
  <!-- App name for various install dialogs -->
  <meta name="application-name" content="Load Test" />
  <meta name="apple-mobile-web-app-title" content="Load Test" />
  <link rel="stylesheet" href="style.css?v=20240710" />
  <!-- App icons: prefer PNG fallbacks for broad compatibility; keep SVG for mask-icon/pinned tabs -->
  <link rel="icon" href="icons/load-home-bolt-192.png" type="image/png" sizes="192x192" />
  <link rel="icon" href="icons/load-home-bolt-512.png" type="image/png" sizes="512x512" />
  <link rel="apple-touch-icon" href="icons/load-home-bolt-192.png" />
  <!-- Safari pinned tab / maskable icon (uses SVG) -->
  <link rel="mask-icon" href="icons/load-home-bolt.svg" color="#0b6ef0" />
</head>
<body>
  <div id="updateBanner" class="update-banner" hidden>
    <div class="update-inner">
      <div>New version available</div>
      <div class="update-actions">
        <button id="reloadApp" class="btn secondary">Reload</button>
        <button id="dismissUpdate" class="btn ghost">Dismiss</button>
      </div>
    </div>
  </div>
<header class="wrap">
  <h1>CEC Sec. 8 - Single Dwelling Load Calculator </span></h1>
  <p class="sub">Based on CSA C22.1:24 Section 8</p>
</header>
<section class="wrap meta-bar">
  <div class="meta-field">
    <label for="inspectionDate">Inspection date</label>
    <input id="inspectionDate" type="date">
  </div>
  <div class="meta-field">
    <label for="policyNumber">Policy</label>
    <input id="policyNumber" type="text" placeholder="Policy number">
  </div>
</section>

<!-- Watts calculator (moved into main later) -->

<main class="wrap grid">
  <!-- Watts calculator moved into the Inputs card to match width -->
  <section class="card col-12">
    <h2>Inputs</h2>
    <form id="calcForm" class="stack" onsubmit="return false;">
      <!-- Inline watts calculator -->
      <div class="calc-sticky-wrapper">
      <div class="stack inline-watts" style="margin-bottom:0.6rem;">
        <div class="row" style="align-items:center;gap:0.75rem;">
          <input id="calcValue" type="number" inputmode="decimal" min="0" step="0.1" placeholder="Amps" />
          <div style="font-weight:700">×</div>
          <select id="calcVoltage" aria-label="Voltage">
            <option value="120">120 V</option>
            <option value="240" selected>240 V</option>
          </select>
          <div style="font-weight:700">=</div>
          <div id="calcResult" class="fixed-value mono" style="min-width:110px;text-align:right;">-- W</div>
          <button id="clearCalc" class="btn ghost" type="button">Clear</button>
        </div>
      </div>
      </div>
            <fieldset class="stack collapsible">
        <legend>
          <button class="collapse-toggle" type="button" aria-expanded="true" aria-controls="section-area">
            <span>Area</span>
            <span class="chevron" aria-hidden="true"></span>
          </button>
        </legend>
        <div class="collapse-body" id="section-area">
          <div class="grid">
            <div class="col-6">
              <label for="groundUpperArea">Ground + upper living area (ft^2)</label>
              <input id="groundUpperArea" type="number" inputmode="decimal" min="0" step="1" placeholder="1200" required>
                            <div class="dim-helper" aria-live="polite">
                <div class="dim-rows" id="groundUpperDimRows">
                  <div class="dim-row" data-initial="true">
                    <input id="groundUpperLength" class="dim-length" type="number" inputmode="decimal" min="0" step="0.1" placeholder="Length (ft)">
                    <span class="dim-symbol">&times;</span>
                    <input id="groundUpperWidth" class="dim-width" type="number" inputmode="decimal" min="0" step="0.1" placeholder="Width (ft)">
                  </div>
                </div>
                <div class="dim-footer">
                  <button id="addGroundUpperDim" class="btn ghost" type="button">Add section</button>
                  <span class="dim-symbol">=</span>
                  <span class="dim-area" id="groundUpperCalc">--</span>
                </div>
              </div>
              <p class="help dim-note">Enter dimensions then click "Add section" to add the computed area to the main field.</p>
            </div>
            <div class="col-6">
              <label for="basementArea">Basement area >= 5 ft 11 in (1.8 m) height (ft^2)</label>
              <input id="basementArea" type="number" inputmode="decimal" min="0" step="1" placeholder="1200">
                            <div class="dim-helper" aria-live="polite">
                <div class="dim-rows" id="basementDimRows">
                  <div class="dim-row" data-initial="true">
                    <input id="basementLength" class="dim-length" type="number" inputmode="decimal" min="0" step="0.1" placeholder="Length (ft)">
                    <span class="dim-symbol">&times;</span>
                    <input id="basementWidth" class="dim-width" type="number" inputmode="decimal" min="0" step="0.1" placeholder="Width (ft)">
                  </div>
                </div>
                <div class="dim-footer">
                  <button id="addBasementDim" class="btn ghost" type="button">Add section</button>
                  <span class="dim-symbol">=</span>
                  <span class="dim-area" id="basementCalc">--</span>
                </div>
              </div>
              <p class="help">Only the portion >= 1.8 m high counts at 75% toward the living area.</p>
            </div>
          </div>
        </div>
      </fieldset>

            <fieldset class="stack collapsible">
        <legend>
    <button class="collapse-toggle" type="button" aria-expanded="false" aria-controls="section-space">
            <span>Space conditioning (8-106(3))</span>
            <span class="chevron" aria-hidden="true"></span>
          </button>
        </legend>
  <div class="collapse-body" id="section-space" hidden>
          <div class="grid">
                    <div class="col-12">
                      <label>Electric space heating loads</label>
                      <div id="spaceHeatList" class="list"></div>
                      <div class="split">
                        <div class="row">
                          <input id="spaceHeatName" type="text" placeholder="Appliance Name" />
                          <select id="spaceHeatType">
                            <option value="watts" selected>Watts</option>
                            <option value="amps">Amps</option>
                          </select>
                          <input id="spaceHeatValue" type="number" inputmode="decimal" min="0" step="1" placeholder="Watts" />
                          <input id="spaceHeatVoltage" type="number" inputmode="decimal" min="0" step="1" value="240" placeholder="Voltage (V)" style="display:none;" />
                        </div>
                        <button class="btn" id="addSpaceHeat" type="button">Add</button>
                      </div>
                      <p class="help">Enter each heating appliance by watts or by amps @ voltage; loads are counted at 100%.</p>
                    </div>
                    <div class="col-12">
                      <label>Air conditioning loads</label>
                      <div id="airCondList" class="list"></div>
                      <div class="split">
                        <div class="row">
                          <input id="airCondName" type="text" placeholder="Appliance Name" />
                          <select id="airCondType">
                            <option value="watts" selected>Watts</option>
                            <option value="amps">Amps</option>
                          </select>
                          <input id="airCondValue" type="number" inputmode="decimal" min="0" step="1" placeholder="Watts" />
                          <input id="airCondVoltage" type="number" inputmode="decimal" min="0" step="1" value="240" placeholder="Voltage (V)" style="display:none;" />
                        </div>
                        <button class="btn" id="addAirCond" type="button">Add</button>
                      </div>
                      <p class="help">Enter each cooling appliance by watts or by amps @ voltage.</p>
                    </div>
                    <div class="col-4">
                      <label for="interlock">Interlock heat vs A/C?</label>
                      <select id="interlock">
                        <option value="yes">Yes - use greater of heat or A/C</option>
                        <option value="no" selected>No - add both</option>
                      </select>
                    </div>
                  </div>
        </div>
      </fieldset>

            <fieldset class="stack collapsible">
        <legend>
    <button class="collapse-toggle" type="button" aria-expanded="false" aria-controls="section-cooking">
            <span>Cooking (8-200(1)(a)(iv))</span>
            <span class="chevron" aria-hidden="true"></span>
          </button>
        </legend>
  <div class="collapse-body" id="section-cooking" hidden>
          <div class="grid">
                    <div class="col-12">
                      <label>Ranges</label>
                      <div id="rangeList" class="list"></div>
                      <div class="split">
                        <div class="row">
                          <input id="rangeName" type="text" placeholder="e.g., Kitchen range" />
                          <input id="rangeCount" type="number" min="1" step="1" value="1" placeholder="Qty" />
                          <input id="rangeWatts" type="number" min="0" step="1" value="12000" placeholder="Watts" />
                        </div>
                        <button class="btn" id="addRange" type="button">Add</button>
                      </div>
                      <p class="help">Demand per 8-200(1)(a)(iv): 6000 W for each range + 40% of any nameplate over 12 000 W.</p>
                    </div>
                  </div>
        </div>
      </fieldset>

            <fieldset class="stack collapsible">
        <legend>
    <button class="collapse-toggle" type="button" aria-expanded="false" aria-controls="section-water">
            <span>Water heating (8-200(1)(a)(v))</span>
            <span class="chevron" aria-hidden="true"></span>
          </button>
        </legend>
  <div class="collapse-body" id="section-water" hidden>
          <div class="grid">
            <div class="col-6">
              <label for="tanklessWatts">Tankless water heater(s) - total (W)</label>
              <input id="tanklessWatts" type="number" min="0" step="1" value="0">
            </div>
            <div class="col-6">
              <label for="storageWHWatts">Standard storage water heater - total (W)</label>
              <input id="storageWHWatts" type="number" min="0" step="1" value="0">
              <p class="help">This will be counted under "Other &gt;1500 W" (25% if a range is provided).</p>
            </div>
            <div class="col-12">
              <label>Steamers / pools / hot tubs / spas</label>
              <div id="specialWaterList" class="list"></div>
              <div class="split">
                <div class="row">
                  <input id="specialWaterName" type="text" placeholder="e.g., Spa heater" />
                  <input id="specialWaterWatts" type="number" min="0" step="1" placeholder="Watts" />
                </div>
                <button class="btn" id="addSpecialWater" type="button">Add</button>
              </div>
              <p class="help">Add each dedicated heater separately so they can be tracked individually.</p>
            </div>
          </div>
        </div>
      </fieldset>

            <fieldset class="stack collapsible">
        <legend>
    <button class="collapse-toggle" type="button" aria-expanded="false" aria-controls="section-ev">
            <span>EV charging (8-200(1)(a)(vi), 8-106(10)-(11), 8-500)</span>
            <span class="chevron" aria-hidden="true"></span>
          </button>
        </legend>
  <div class="collapse-body" id="section-ev" hidden>
          <div class="grid">
                    <div class="col-4">
                      <label for="evseCount">Electric vehicle charger quantity</label>
                      <input id="evseCount" type="number" min="0" step="1" value="0">
                    </div>
                    <div class="col-4">
                      <label for="evseWatts">Charger rating (W)</label>
                      <input id="evseWatts" type="number" min="0" step="1" value="0">
                    </div>
                    <div class="col-4">
                      <label for="evems">EVEMS (electric vehicle energy management system) compliant?</label>
                      <select id="evems">
                        <option value="no" selected>No - include EVSE at 100%</option>
                        <option value="yes">Yes - exclude EVSE per 8-106(11)</option>
                      </select>
                    </div>
                  </div>
        </div>
      </fieldset>

            <fieldset class="stack collapsible">
        <legend>
    <button class="collapse-toggle" type="button" aria-expanded="false" aria-controls="section-appliances">
            <span>Other fixed appliances &gt; 1500 W (8-200(1)(a)(vii))</span>
            <span class="chevron" aria-hidden="true"></span>
          </button>
        </legend>
  <div class="collapse-body" id="section-appliances" hidden>
          <div id="applianceList" class="list"></div>
                  <div class="split">
                    <div class="row">
                      <input id="applianceName" type="text" placeholder="e.g., Dryer" />
                      <input id="applianceWatts" type="number" min="0" step="1" placeholder="Watts" />
                    </div>
                    <button class="btn" id="addAppliance">Add</button>
                  </div>
                  <p class="help">If a range is provided, include 25% of each listed load. If no range, include 100% of the first 6000 W combined + 25% of the remainder.</p>
        </div>
      </fieldset>

            <fieldset class="stack collapsible">
        <legend>
    <button class="collapse-toggle" type="button" aria-expanded="false" aria-controls="section-system">
            <span>System</span>
            <span class="chevron" aria-hidden="true"></span>
          </button>
        </legend>
  <div class="collapse-body" id="section-system" hidden>
          <div class="grid">
            <div class="col-6">
              <label>Service configuration</label>
              <div class="fixed-value">120 / 240 V, 1-ph (fixed)</div>
            </div>
          </div>
        </div>
      </fieldset>

            <fieldset class="stack collapsible">
        <legend>
    <button class="collapse-toggle" type="button" aria-expanded="false" aria-controls="section-notes">
            <span>Notes</span>
            <span class="chevron" aria-hidden="true"></span>
          </button>
        </legend>
  <div class="collapse-body" id="section-notes" hidden>
          <div class="grid">
            <div class="col-12">
              <label for="systemNotes">Notes</label>
              <textarea id="systemNotes" placeholder="Add notes about the system or inspection..." rows="5"></textarea>
              <div class="row toggle-row" style="align-items:center;">
                <label class="switch" for="includeNotes" style="margin:0;">
                  <input id="includeNotes" type="checkbox" />
                  <span class="slider" aria-hidden="true"></span>
                </label>
                <label for="includeNotes" style="margin:0;font-weight:600;color:var(--text);">Include in report</label>
              </div>
            </div>
          </div>
        </div>
      </fieldset>

      <div class="row action-row">
        <div style="display:flex;gap:0.5rem;align-items:center;">
          <button id="saveDraftBtn" class="btn ghost" type="button">Save draft</button>
          <button id="loadDraftBtn" class="btn" type="button">Load draft</button>
        </div>
        <div style="margin-left:auto;display:flex;gap:0.6rem;">
          <button id="reportBtn" class="btn secondary" type="button">Generate Report</button>
          <button id="resetBtn" class="btn" type="reset">Reset</button>
        </div>
      </div>
    </form>
  </section>

  <section class="card col-12">
    <h2>Results</h2>

    <div id="results" class="grid">
      <div class="col-6">
        <div class="result">
          <div class="kicker">Path A - Detailed sum (8-200(1)(a))</div>
          <div><strong id="pathA">0</strong> W</div>
        </div>
      </div>
      <div class="col-6">
        <div class="result">
          <div class="kicker">Path B - Fixed minimum (8-200(1)(b))</div>
          <div><strong id="pathB">0</strong> W</div>
        </div>
      </div>
      <div class="col-12">
        <div class="warn">
          <div class="kicker">Calculated load (greater of A or B)</div>
          <div><strong id="calcLoad">0</strong> W</div>
        </div>
      </div>
      <div class="col-6">
        <div class="card">
          <div class="kicker">Minimum service/feeder current</div>
          <div class="big"><strong id="minAmps">0</strong> A @ <span id="voltsLabel">240</span> V</div>
          <p class="help">Per 8-200(3), the overall dwelling calc is not treated as 100% continuous for 8-104.</p>
        </div>
      </div>
      <div class="col-6">
        <div class="card">
          <div class="kicker">Why a basement change may not move the result</div>
          <ul class="notes">
            <li>Basement only affects <strong>Path A</strong> via the basic load (75% factor). It does <em>not</em> change Path B.</li>
            <li>If Path B (24 000 W / 14 400 W) still governs, the final result won't change until Path A exceeds Path B.</li>
          </ul>
        </div>
      </div>
    </div>
  </section>
</main>

<script src="app.js?v=20240710"></script>
</body>
</html>

